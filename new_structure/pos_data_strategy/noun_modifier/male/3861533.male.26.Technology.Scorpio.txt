hallvard vassbotn blog interface delphi interface solution new solution news usenet news way hallvards way function cool function getimplementingobject const ainterface iinterface tobject const addbyte opcode dword ptr shortint opcode addlong opcode add dword ptr longint type padjustselfthunk tadjustselfthunk tadjustselfthunk record case addinstruction longint addbyte adjustmentbyte shortint end longint end pinterfacemt tinterfacemt tinterfacemt record queryinterfacethunk end padjustselfthunk end tinterfaceref pinterfacemt queryinterfacethunk padjustselfthunk result pointer ainterface result try queryinterfacethunk ainterface tinterfaceref ainterface queryinterfacethunk case addinstruction queryinterfacethunk addinstruction addbyte inc pchar result queryinterfacethunk adjustmentbyte pchar inc pchar result queryinterfacethunk adjustmentlong result end nil end result end nil end end method hallvard post usenet post hack relies fact interface iinterface implement free implement method dynamic method case prologue identical prologue code self pointer stack adjustment fit constant fit byte shortint longint entire longint size parent class check case adjustment self adjustment field case general case compiler kind different kind thunk dimension interface method table imt instance shortint longint convention stack safecall pascal safecall register interface dynamic interface message declare message method register dynamic register method code interesting code cannot modify register way old way function getimplementingobject const ainstance iunknown const aguid tguid const aimplclass tclass tobject var linterfaceentry pinterfaceentry result aimplclass nil aimplclass nil ainstance begin nil begin exit end linterfaceentry aimplclass getinterfaceentry aguid linterfaceentry begin linterfaceentry ioffset result integer tobject integer ainstance linterfaceentry end end end end blogger current blogger theme source code